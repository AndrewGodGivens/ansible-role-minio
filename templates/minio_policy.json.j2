{
  "Version": "2012-10-17",
  "Statement": [
{% for acl in user.buckets_acl %}
{% if acl['name'] and acl['policy'] %}
{% if acl['policy'] == 'read-write' %}
    {
      "Effect": "Allow",
      "Principal": {
          "AWS": ["*"]
      },
      "Action": [
          "s3:GetBucketLocation",
          "s3:ListBucket",
          "s3:ListBucketMultipartUploads"
      ],
      "Resource": ["arn:aws:s3:::{{ acl['name'] }}"]
    }, 
    {
      "Effect":"Allow",
      "Principal":{
          "AWS":["*"]
      },
      "Action":[
          "s3:GetObject",
          "s3:ListMultipartUploadParts",
          "s3:PutObject",
          "s3:AbortMultipartUpload",
          "s3:DeleteObject"
      ],
      "Resource":["arn:aws:s3:::{{ acl['name'] }}/*"]
    {{ "}," if not loop.last else "}" }}  
{% endif %}
{% if acl['policy'] == 'read-only' %}
    {
      "Effect": "Allow",
      "Principal": {
          "AWS": ["*"]
      },
      "Action": ["s3:GetBucketLocation"],
      "Resource": ["arn:aws:s3:::{{ acl['name'] }}"]
    },
    {
      "Effect": "Allow",
      "Principal": {
          "AWS":["*"]
      },
      "Action": ["s3:ListBucket"],
      "Resource": ["arn:aws:s3:::{{ acl['name'] }}"]
    },
    {
      "Effect": "Allow",
      "Principal": {
          "AWS":["*"]
      },
      "Action": ["s3:GetObject"],
      "Resource": ["arn:aws:s3:::{{ acl['name'] }}/*"]
    {{ "}," if not loop.last else "}" }}
{% endif %}
{% endif %}
{% endfor %}
  ]
}
